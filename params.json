{"name":"CPU Cache Lines","tagline":"test effect of cache lines on performance","body":"# Background\r\nMy company recently kicked off a speaker series and the first speaker was Martin Thompson (LMAX, Disruptor, Mechanical Sympathy, SBE, etc).\r\n\r\nOne of his focus areas when designing performing software, is to ensure the software is developed with reference to the underlying CPU and memory constraints.\r\n\r\nHe covered a topic on CPU cache lines, and this made me think about writing some C code to test and demonstrate this effect.\r\n\r\n# So....what's being tested\r\nThe working premise is that the CPU cache lines are 64 bytes. This means that when accessing 2 elements of a struct, separated by more than 64 bytes, a cache miss will occur (or more specifically, no guarantee the 65th byte onwards is in the cache). \r\n\r\n# How to demonstrate\r\nI created 2 structs, one with 64 bytes (essentially, optimally packed) and another with the same number of elements, but aligned such as to spill over into the 65th byte and more.\r\n\r\nI created an array of each struct type, and iterated over the array, accessing 2 specific struct members, and times the access.\r\n\r\nOnce I had done this, I looked at adding CPU affinity and changing priority to see the effects.\r\n\r\n# Conclusion\r\n\r\nThere is a demonstratable difference when the struct elements are in the same cache line. CPU affinity and priority really just serve to remove noise and jitter.\r\n\r\nThe following 4 charts were created from the raw data located in the \"data\" directory.\r\n\r\n![CPU Affinity enabled, Max PRIO](https://github.com/eddiemcnally/cpu_cache_line/blob/master/data/affinity_max_prio.png?raw=true)\r\n\r\n![CPU Affinity enabled, Normal PRIO](https://github.com/eddiemcnally/cpu_cache_line/blob/master/data/affinity_norm_prio.png?raw=true)\r\n\r\n![No CPU Affinity enabled, MAX PRIO](https://github.com/eddiemcnally/cpu_cache_line/blob/master/data/no_affinity_max_prio.png?raw=true)\r\n\r\n![No CPU Affinity enabled, Normal PRIO](https://github.com/eddiemcnally/cpu_cache_line/blob/master/data/no_affinity_norm_prio.png?raw=true)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}